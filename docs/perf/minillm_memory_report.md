# Mini LLM Memory & Latency Report

이 문서는 `manager`가 추론 경로에서 `OptimizedV3Planner`를 사용하도록 변경한 이후, 소형 LLM 그래프에서의 메모리·시간 특성을 요약합니다.

## 실험 설정
- **그래프**: 4 레이어짜리 데코더 전용 LLM 블록을 단일 배치/토큰으로 추론할 때의 활성화 수명/크기를 정수 바이트로 근사 (`{2048, 1024, 768, 512, 768, 512}` bytes).
- **측정 항목**: `planLayout`이 요구하는 피크 메모리와 실행 평균 시간.
- **재현 커맨드**:
  ```bash
  tools/perf/run_minillm_planner_bench.py
  ```
  (스크립트는 실험용 C++ 바이너리를 즉석에서 컴파일하여 동일한 NNTrainer 구현을 그대로 호출합니다.)

## 결과
| Planner | Peak memory (bytes) | Avg plan time (µs) |
|---------|---------------------|--------------------|
| OptimizedV1 | 4,352 | 0.127 |
| OptimizedV3 | 3,072 | 0.223 |

- **피크 메모리**: V3가 동일한 작업에서 29.4% 더 작은 풀 크기를 요구했습니다.
- **계획 시간**: V3는 부분 공간 재사용을 위해 계산량이 늘어 약 0.1 µs 정도 느려졌지만, 추론 단계 전체 대비 무시할 수 있는 수준입니다.

## 해석
- V3는 부분 재사용이 가능한 공백을 찾아 재배치하므로, 활성화 크기가 제각각인 LLM 블록에서 가장 큰 메모리 갭을 채워 피크 메모리를 낮춥니다.
- V1은 동일 크기 블록만 재사용하기 때문에 큰 블록이 해제된 이후에도 그 공간을 다시 활용하지 못해 1KB 이상을 낭비합니다.
- 평균 계획 시간 증가보다 피크 메모리 절감이 훨씬 크기 때문에, 추론 모드에서 V3를 기본으로 사용하는 것이 합리적입니다.
