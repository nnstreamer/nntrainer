# Pull Request 3587 ë¦¬ë·° ë³´ê³ ì„œ

## ê°œìš”
- **PR ì œëª©**: [Application] tizen build for causal
- **ì»¤ë°‹**: bc4510e9d2d7f785b468e6568d2b8276b749003c
- **ì‘ì„±ì**: Hyeonseok Lee <hs89.lee@samsung.com>

## ë³€ê²½ì‚¬í•­ ìš”ì•½
1. Tizen í”Œë«í¼ì—ì„œ CausalLM ë¹Œë“œ í™œì„±í™”
2. ì»´íŒŒì¼ í”Œë˜ê·¸ ì¶”ê°€ ë° ìˆ˜ì •
3. ëˆ„ë½ëœ í—¤ë” íŒŒì¼ ì¶”ê°€
4. OpenMP pragma ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •
5. íŒ¨í‚¤ì§• ìŠ¤í™ íŒŒì¼ ì—…ë°ì´íŠ¸

---

## 1. ë…¼ë¦¬ì  ë²„ê·¸ ê²€í† 

### âœ… ì˜¬ë°”ë¥¸ ë³€ê²½ì‚¬í•­

#### 1.1 Applications/meson.build (58-60ì¤„)
```diff
- if (get_option('platform') != 'tizen') and (get_option('platform') != 'windows')
+ if get_option('platform') != 'windows'
```
**í‰ê°€**: ì˜¬ë°”ë¥¸ ë³€ê²½ì…ë‹ˆë‹¤. Tizen í”Œë«í¼ì—ì„œë„ CausalLMì„ ë¹Œë“œí•  ìˆ˜ ìˆë„ë¡ ì œí•œì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.

#### 1.2 nntrainer/tensor/cpu_backend/arm/neon_impl.h
```diff
+ #include <climits>
```
**í‰ê°€**: ì˜¬ë°”ë¥¸ ë³€ê²½ì…ë‹ˆë‹¤. `UINT_MAX` ìƒìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í—¤ë”ì…ë‹ˆë‹¤. ì½”ë“œì—ì„œ `local_window_size = UINT_MAX`ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

#### 1.3 nntrainer/tensor/cpu_backend/arm/neon_impl_fp16.cpp
```diff
+ #include <cstring>
```
**í‰ê°€**: ì˜¬ë°”ë¥¸ ë³€ê²½ì…ë‹ˆë‹¤. `std::memcpy` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í—¤ë”ì…ë‹ˆë‹¤ (57ì¤„ì—ì„œ ì‚¬ìš©).

#### 1.4 nntrainer/tensor/cpu_backend/arm/neon_kleidiai.cpp (444ì¤„)
```diff
- #pragma omp parallel for num_thread(n_threads)
+ #pragma omp parallel for num_threads(n_threads)
```
**í‰ê°€**: ì˜¬ë°”ë¥¸ ìˆ˜ì •ì…ë‹ˆë‹¤. OpenMP í‘œì¤€ ë¬¸ë²•ì— ë§ê²Œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. `num_thread`ëŠ” ì˜ëª»ëœ ë¬¸ë²•ì´ê³  `num_threads`ê°€ ì˜¬ë°”ë¥¸ ë¬¸ë²•ì…ë‹ˆë‹¤.

### âš ï¸ ì ì¬ì  ë¬¸ì œì 

#### 1.5 packaging/nntrainer.spec - Transformer ì§€ì› ë¡œì§ (63-67ì¤„)
```rpm
%if (0%{?enable_fp16}) && (0%{?enable_transformer})
%define transformer_support -Denable-transformer=true
%else
%define transformer_support -Denable-transformer=false
%endif
```

**ë¬¸ì œì **:
1. **ë…¼ë¦¬ì  ì˜¤ë¥˜**: TransformerëŠ” FP16ê³¼ ë…ë¦½ì ìœ¼ë¡œ í™œì„±í™”ë  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ë¡œì§ì€ FP16ê³¼ Transformerê°€ ëª¨ë‘ í™œì„±í™”ë˜ì–´ì•¼ë§Œ Transformerë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
2. **ë³€ìˆ˜ ì •ì˜ í™•ì¸ í•„ìš”**: `enable_transformer` ë³€ìˆ˜ê°€ RPM ë¹Œë“œ ì‹œ ì–´ë–»ê²Œ ì •ì˜ë˜ëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë§Œì•½ ì´ ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šìœ¼ë©´ ì¡°ê±´ì´ í•­ìƒ falseê°€ ë©ë‹ˆë‹¤.
3. **ê¸°ë³¸ê°’ ë¬¸ì œ**: FP16ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ Transformerë„ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ëŠ”ë°, ì´ëŠ” ì˜ë„ëœ ë™ì‘ì¸ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.

**ê¶Œì¥ ìˆ˜ì •**:
```rpm
%if 0%{?enable_transformer}
%define transformer_support -Denable-transformer=true
%else
%define transformer_support -Denable-transformer=false
%endif
```

ë˜ëŠ” FP16ê³¼ ë…ë¦½ì ìœ¼ë¡œ í™œì„±í™”í•˜ë ¤ë©´:
```rpm
%if (0%{?enable_fp16}) || (0%{?enable_transformer})
%define transformer_support -Denable-transformer=true
%else
%define transformer_support -Denable-transformer=false
%endif
```

---

## 2. ì„±ëŠ¥ ë²„ê·¸ ê²€í† 

### âœ… ì„±ëŠ¥ì— ì˜í–¥ ì—†ëŠ” ë³€ê²½ì‚¬í•­
- í—¤ë” íŒŒì¼ ì¶”ê°€: ì»´íŒŒì¼ íƒ€ì„ì—ë§Œ ì˜í–¥ì„ ì£¼ë©° ëŸ°íƒ€ì„ ì„±ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ
- ê²½ê³  í”Œë˜ê·¸ ì¶”ê°€: ì»´íŒŒì¼ íƒ€ì„ ê²½ê³  ì–µì œë§Œ í•˜ë©° ì„±ëŠ¥ ì˜í–¥ ì—†ìŒ
- OpenMP pragma ìˆ˜ì •: ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ë™ì‘ ë³´ì¥

### âš ï¸ í™•ì¸ í•„ìš”í•œ ì‚¬í•­

#### 2.1 C í‘œì¤€ ë³€ê²½ (meson.build 8ì¤„)
```diff
- 'c_std=gnu89',
+ 'c_std=gnu99',
```

**í‰ê°€**: 
- C99 í‘œì¤€ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ëŠ” ê²ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ë¬¸ì œì—†ì§€ë§Œ, ê¸°ì¡´ ì½”ë“œê°€ C89ì— ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ì´ ìˆëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
- C99ì˜ ì£¼ìš” ë³€ê²½ì‚¬í•­:
  - ë³€ìˆ˜ ì„ ì–¸ ìœ„ì¹˜ ì œí•œ ì™„í™” (ë¸”ë¡ ì‹œì‘ ë¶€ë¶„ì´ ì•„ë‹Œ ì–´ë””ì„œë‚˜ ì„ ì–¸ ê°€ëŠ¥)
  - `//` ì£¼ì„ ì§€ì›
  - `inline` í‚¤ì›Œë“œ ì§€ì›
  - `long long` íƒ€ì… ì§€ì›

**ê¶Œì¥ì‚¬í•­**: ê¸°ì¡´ C ì½”ë“œê°€ C99ì™€ í˜¸í™˜ë˜ëŠ”ì§€ ë¹Œë“œ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ í™•ì¸ í•„ìš”.

---

## 3. ì»¤ë°‹ ë©”ì‹œì§€ì™€ ì½”ë“œ ë³€ê²½ì‚¬í•­ì˜ ì¼ê´€ì„± ê²€í† 

### ì»¤ë°‹ ë©”ì‹œì§€ ë‚´ìš©:
```
[Application] tizen build for causal

 - Build for tokenizer lib and json hpp still have some issues
 - Added compile flags
 - Added omitted header
 - Including missing header
 - Fix typo
```

### ì‹¤ì œ ë³€ê²½ì‚¬í•­ê³¼ì˜ ë¹„êµ:

| ì»¤ë°‹ ë©”ì‹œì§€ í•­ëª© | ì‹¤ì œ ë³€ê²½ì‚¬í•­ | ì¼ê´€ì„± |
|----------------|------------|--------|
| "Build for tokenizer lib and json hpp still have some issues" | Tizenì—ì„œ CausalLM ë¹Œë“œ í™œì„±í™” | âœ… ì¼ì¹˜ |
| "Added compile flags" | ê²½ê³  í”Œë˜ê·¸ ì¶”ê°€ (`-Wno-unused-but-set-variable`, `-Wno-unused-function`, `-Wno-array-bounds`, `-Wno-declaration-after-statement`) | âœ… ì¼ì¹˜ |
| "Added omitted header" | `hgemm_noTrans.h`, `hgemm_transA.h`, `hgemm_transAB.h`, `hgemm_transB.h` ì¶”ê°€ | âœ… ì¼ì¹˜ |
| "Including missing header" | `<climits>`, `<cstring>` ì¶”ê°€ | âœ… ì¼ì¹˜ |
| "Fix typo" | `num_thread` â†’ `num_threads` ìˆ˜ì • | âœ… ì¼ì¹˜ |

### âš ï¸ ì»¤ë°‹ ë©”ì‹œì§€ì— ëˆ„ë½ëœ ë³€ê²½ì‚¬í•­:
1. **C í‘œì¤€ ë³€ê²½**: `gnu89` â†’ `gnu99` ë³€ê²½ì´ ì»¤ë°‹ ë©”ì‹œì§€ì— ëª…ì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ëŠ” ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ì´ë¯€ë¡œ ì»¤ë°‹ ë©”ì‹œì§€ì— í¬í•¨í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
2. **Transformer ì§€ì› ë¡œì§ ì¶”ê°€**: `nntrainer.spec`ì— transformer ì§€ì› ë¡œì§ì´ ì¶”ê°€ë˜ì—ˆì§€ë§Œ ì»¤ë°‹ ë©”ì‹œì§€ì— ì–¸ê¸‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

---

## 4. ì¶”ê°€ ê²€í†  ì‚¬í•­

### 4.1 í—¤ë” íŒŒì¼ ì¶”ê°€ (hgemm/meson.build)
ì¶”ê°€ëœ í—¤ë” íŒŒì¼ë“¤ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤:
- `hgemm_noTrans.h`
- `hgemm_transA.h`
- `hgemm_transAB.h`
- `hgemm_transB.h`

### 4.2 ê²½ê³  í”Œë˜ê·¸ ì¶”ê°€ì˜ ì˜í–¥
ë‹¤ìŒ ê²½ê³  í”Œë˜ê·¸ë“¤ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:
- `-Wno-unused-but-set-variable`: ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ ì„¤ì •ëœ ë³€ìˆ˜ ê²½ê³  ì–µì œ
- `-Wno-unused-function`: ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” í•¨ìˆ˜ ê²½ê³  ì–µì œ
- `-Wno-array-bounds`: ë°°ì—´ ê²½ê³„ ê²€ì‚¬ ê²½ê³  ì–µì œ
- `-Wno-declaration-after-statement`: ì„ ì–¸ í›„ ë¬¸ì¥ ê²½ê³  ì–µì œ

**ì£¼ì˜ì‚¬í•­**: `-Wno-array-bounds`ëŠ” ì ì¬ì ì¸ ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ë¬¸ì œë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ ê²½ê³ ë¥¼ ì–µì œí•˜ëŠ” ëŒ€ì‹  ì‹¤ì œ ë¬¸ì œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•©ë‹ˆë‹¤.

---

## 5. ì¢…í•© í‰ê°€ ë° ê¶Œì¥ì‚¬í•­

### âœ… ê¸ì •ì ì¸ ë³€ê²½ì‚¬í•­:
1. Tizen í”Œë«í¼ ì§€ì› í™•ëŒ€
2. ëˆ„ë½ëœ í—¤ë” íŒŒì¼ ì¶”ê°€ë¡œ ì»´íŒŒì¼ ì˜¤ë¥˜ í•´ê²°
3. OpenMP ë¬¸ë²• ì˜¤ë¥˜ ìˆ˜ì •
4. í•„ìš”í•œ í—¤ë” íŒŒì¼ í¬í•¨

### âš ï¸ ìˆ˜ì •ì´ í•„ìš”í•œ ì‚¬í•­:
1. **nntrainer.specì˜ transformer ì§€ì› ë¡œì§**: FP16ê³¼ì˜ ì˜ì¡´ì„± ê´€ê³„ë¥¼ ëª…í™•íˆ í•˜ê³ , ì˜ë„ì— ë§ê²Œ ìˆ˜ì • í•„ìš”
2. **ì»¤ë°‹ ë©”ì‹œì§€ ë³´ì™„**: C í‘œì¤€ ë³€ê²½ê³¼ transformer ì§€ì› ë¡œì§ ì¶”ê°€ë¥¼ ëª…ì‹œ

### ğŸ“ ê¶Œì¥ ì¡°ì¹˜:
1. Transformer ì§€ì› ë¡œì§ì˜ ì˜ë„ë¥¼ ëª…í™•íˆ í•˜ê³ , í•„ìš”ì‹œ ë¡œì§ ìˆ˜ì •
2. C99 í‘œì¤€ ë³€ê²½ì— ëŒ€í•œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
3. `-Wno-array-bounds` ê²½ê³  ì–µì œ ëŒ€ì‹  ì‹¤ì œ ë¬¸ì œ í•´ê²° ê²€í† 
4. ì»¤ë°‹ ë©”ì‹œì§€ì— ëˆ„ë½ëœ ë³€ê²½ì‚¬í•­ ì¶”ê°€

---

## ê²°ë¡ 

ëŒ€ë¶€ë¶„ì˜ ë³€ê²½ì‚¬í•­ì€ ì˜¬ë°”ë¥´ê³  í•„ìš”í•œ ìˆ˜ì •ì…ë‹ˆë‹¤. ë‹¤ë§Œ `nntrainer.spec`ì˜ transformer ì§€ì› ë¡œì§ì— ë…¼ë¦¬ì  ë¬¸ì œê°€ ìˆì–´ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë˜í•œ ì»¤ë°‹ ë©”ì‹œì§€ì— ì¼ë¶€ ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ì´ ëˆ„ë½ë˜ì–´ ìˆì–´ ë³´ì™„ì´ í•„ìš”í•©ë‹ˆë‹¤.

**ì „ì²´ í‰ê°€**: âš ï¸ **ì¡°ê±´ë¶€ ìŠ¹ì¸** (transformer ì§€ì› ë¡œì§ ìˆ˜ì • í•„ìš”)
